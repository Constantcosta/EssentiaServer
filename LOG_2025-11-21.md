# Log – 2025-11-21

## Summary of Work
- BPM refinement: Added harmonic/percussive periodicity refinement in `backend/analysis/tempo_detection.py`; built `tools/bpm_context_lab.py` to test tricky + baseline tracks; improved `tools/stem_probe.py`.
- Stem separation: Ran Demucs (htdemucs) on `060_Paramore_Still_Into_You.m4a`; outputs (drums/bass/vocals/other) in `stems_output/htdemucs/060_Paramore_Still_Into_You/`.
- Drum micro-split: Prototype onset-guided band masks created `drum_kick/snare/hats/toms/cymbals.wav` (bleedy).
- Environments: Main venv `.venv` (Python 3.14) with demucs/torch/librosa/soundfile/torchcodec and ffmpeg (brew). Created `.venv-drums` (Python 3.10) for drum-part models; madmom install failed (Cython/build isolation), no per-drum model installed yet.

## BPM Status (current)
- Wrong cases remain: She Loves You (~105/147 vs 153), Don’t Dream It’s Over (~161 vs 81), 2 Become 1 (~143 vs 72), The Gambler (~89 vs 87 feel), Blow Up The Pokies fix suppressed. Baselines (Still Into You, Faint) stable.
- Next BPM steps: loosen gating for 6/8/half-time; add meter cues; integrate drum-part cues when available; rerun `tools/bpm_context_lab.py` and full repertoire online.

## Stem/Drum Assets
- Demucs outputs: `stems_output/htdemucs/060_Paramore_Still_Into_You/` (drums/bass/vocals/other).
- Prototype drum parts in same folder: `drum_kick.wav`, `drum_snare.wav`, `drum_hats.wav`, `drum_toms.wav`, `drum_cymbals.wav`.
- Drum stem to refine: `.../drums.wav`.

## Blockers
- High-quality per-drum separator/transcriber not installed. Madmom failed to build even in `.venv-drums`. Need a Torch/HF drum-part model or external processing of `drums.wav`.
